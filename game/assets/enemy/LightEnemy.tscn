[gd_scene load_steps=8 format=2]

[ext_resource path="res://Scripts/Enemy/ClawMutation.gd" type="Script" id=1]
[ext_resource path="res://Scripts/Enemy/Enemy.gd" type="Script" id=2]
[ext_resource path="res://assets/enemy/mutations/gatling mutation.png" type="Texture" id=3]
[ext_resource path="res://assets/enemy/zombie.png" type="Texture" id=4]
[ext_resource path="res://assets/enemy/mutations/claw mutation.png" type="Texture" id=5]

[sub_resource type="GDScript" id=2]
script/source = "extends Node2D

export(float) var speed = 5
export(float) var attackPeriod = 3
export(float) var mutationPeriod = 10;

var attackTimer: float = 0.0
var mutationTimer: float = 0.0

var mutations = []
var activeMutations: Array
var inactiveMutations: Array
# Called when the node enters the scene tree for the first time.
func _ready():
	mutations = get_node(\"Mutations\").get_children()
	
	activeMutations.append(mutations[0])
	inactiveMutations.append_array(mutations.slice(1, mutations.size()))
	for mut in inactiveMutations:
		print(mut)
		get_node(\"Mutations\").remove_child(mut)
	
func _process(delta):
	attackTimer += delta
	mutationTimer += delta
	
	if(attackTimer > attackPeriod):
		attackTimer = 0.0
		attack();
		
	if(mutationTimer > mutationPeriod):
		mutationTimer = 0.0
		mutate();
		
func attack():
	var index = randi() % activeMutations.size()
	var mutation = activeMutations[index]
	
	print(\"attempt an attack\")
	if(mutation.has_method(\"attack\")):
		mutation.attack()
		
func mutate():
	print(\"attempt mutations\")
	if (activeMutations.size() < mutations.size()):
		print(\"mutate\")
		var index = randi() % inactiveMutations.size()
		var newMutation = inactiveMutations[index]
		get_node(\"Mutations\").add_child(newMutation)
		activeMutations.append(newMutation)
		inactiveMutations.remove(index)
		

# Called every frame. 'delta' is the elapsed time since the previous frame.
#func _process(delta):
#	pass
"

[sub_resource type="RectangleShape2D" id=1]
extents = Vector2( 25.3739, 32.947 )

[node name="LightEnemy" type="Node2D"]
position = Vector2( 509.454, 299.661 )
script = SubResource( 2 )

[node name="Sprite" type="Sprite" parent="."]
texture = ExtResource( 4 )

[node name="Mutations" type="Node2D" parent="."]

[node name="Gatling Mutation" type="Node2D" parent="Mutations"]
position = Vector2( 0.643242, -25.921 )
script = ExtResource( 2 )

[node name="Sprite" type="Sprite" parent="Mutations/Gatling Mutation"]
z_index = -1
texture = ExtResource( 3 )

[node name="ClawMutation" type="Node2D" parent="Mutations"]
position = Vector2( -13.773, 3.44324 )
script = ExtResource( 1 )

[node name="Sprite" type="Sprite" parent="Mutations/ClawMutation"]
position = Vector2( -21.3574, -17.3529 )
texture = ExtResource( 5 )

[node name="Area2D" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Area2D"]
position = Vector2( -5.33929, 0.997742 )
shape = SubResource( 1 )
